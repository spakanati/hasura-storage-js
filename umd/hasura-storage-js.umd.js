(function(I,J){typeof exports=="object"&&typeof module<"u"?J(exports):typeof define=="function"&&define.amd?define(["exports"],J):(I=typeof globalThis<"u"?globalThis:I||self,J(I["@nhost/hasura-storage-js"]={}))})(this,function(I){"use strict";var pa=Object.defineProperty;var ya=(I,J,Q)=>J in I?pa(I,J,{enumerable:!0,configurable:!0,writable:!0,value:Q}):I[J]=Q;var se=(I,J,Q)=>(ya(I,typeof J!="symbol"?J+"":J,Q),Q);function J(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Q={exports:{}},et={exports:{}},Mt=function(e,r){return function(){for(var i=new Array(arguments.length),a=0;a<i.length;a++)i[a]=arguments[a];return e.apply(r,i)}},mn=Mt,tt=Object.prototype.toString,rt=function(t){return function(e){var r=tt.call(e);return t[r]||(t[r]=r.slice(8,-1).toLowerCase())}}(Object.create(null));function ae(t){return t=t.toLowerCase(),function(r){return rt(r)===t}}function nt(t){return Array.isArray(t)}function Ce(t){return typeof t>"u"}function gn(t){return t!==null&&!Ce(t)&&t.constructor!==null&&!Ce(t.constructor)&&typeof t.constructor.isBuffer=="function"&&t.constructor.isBuffer(t)}var qt=ae("ArrayBuffer");function Sn(t){var e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(t):e=t&&t.buffer&&qt(t.buffer),e}function En(t){return typeof t=="string"}function wn(t){return typeof t=="number"}function Bt(t){return t!==null&&typeof t=="object"}function Le(t){if(rt(t)!=="object")return!1;var e=Object.getPrototypeOf(t);return e===null||e===Object.prototype}var xn=ae("Date"),An=ae("File"),On=ae("Blob"),bn=ae("FileList");function it(t){return tt.call(t)==="[object Function]"}function Rn(t){return Bt(t)&&it(t.pipe)}function Pn(t){var e="[object FormData]";return t&&(typeof FormData=="function"&&t instanceof FormData||tt.call(t)===e||it(t.toString)&&t.toString()===e)}var Tn=ae("URLSearchParams");function Nn(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function Dn(){return typeof navigator<"u"&&(navigator.product==="ReactNative"||navigator.product==="NativeScript"||navigator.product==="NS")?!1:typeof window<"u"&&typeof document<"u"}function at(t,e){if(!(t===null||typeof t>"u"))if(typeof t!="object"&&(t=[t]),nt(t))for(var r=0,n=t.length;r<n;r++)e.call(null,t[r],r,t);else for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.call(null,t[i],i,t)}function ot(){var t={};function e(i,a){Le(t[a])&&Le(i)?t[a]=ot(t[a],i):Le(i)?t[a]=ot({},i):nt(i)?t[a]=i.slice():t[a]=i}for(var r=0,n=arguments.length;r<n;r++)at(arguments[r],e);return t}function Un(t,e,r){return at(e,function(i,a){r&&typeof i=="function"?t[a]=mn(i,r):t[a]=i}),t}function Cn(t){return t.charCodeAt(0)===65279&&(t=t.slice(1)),t}function Ln(t,e,r,n){t.prototype=Object.create(e.prototype,n),t.prototype.constructor=t,r&&Object.assign(t.prototype,r)}function jn(t,e,r){var n,i,a,o={};e=e||{};do{for(n=Object.getOwnPropertyNames(t),i=n.length;i-- >0;)a=n[i],o[a]||(e[a]=t[a],o[a]=!0);t=Object.getPrototypeOf(t)}while(t&&(!r||r(t,e))&&t!==Object.prototype);return e}function In(t,e,r){t=String(t),(r===void 0||r>t.length)&&(r=t.length),r-=e.length;var n=t.indexOf(e,r);return n!==-1&&n===r}function _n(t){if(!t)return null;var e=t.length;if(Ce(e))return null;for(var r=new Array(e);e-- >0;)r[e]=t[e];return r}var Fn=function(t){return function(e){return t&&e instanceof t}}(typeof Uint8Array<"u"&&Object.getPrototypeOf(Uint8Array)),$={isArray:nt,isArrayBuffer:qt,isBuffer:gn,isFormData:Pn,isArrayBufferView:Sn,isString:En,isNumber:wn,isObject:Bt,isPlainObject:Le,isUndefined:Ce,isDate:xn,isFile:An,isBlob:On,isFunction:it,isStream:Rn,isURLSearchParams:Tn,isStandardBrowserEnv:Dn,forEach:at,merge:ot,extend:Un,trim:Nn,stripBOM:Cn,inherits:Ln,toFlatObject:jn,kindOf:rt,kindOfTest:ae,endsWith:In,toArray:_n,isTypedArray:Fn,isFileList:bn},ue=$;function kt(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var Ht=function(e,r,n){if(!r)return e;var i;if(n)i=n(r);else if(ue.isURLSearchParams(r))i=r.toString();else{var a=[];ue.forEach(r,function(u,l){u===null||typeof u>"u"||(ue.isArray(u)?l=l+"[]":u=[u],ue.forEach(u,function(d){ue.isDate(d)?d=d.toISOString():ue.isObject(d)&&(d=JSON.stringify(d)),a.push(kt(l)+"="+kt(d))}))}),i=a.join("&")}if(i){var o=e.indexOf("#");o!==-1&&(e=e.slice(0,o)),e+=(e.indexOf("?")===-1?"?":"&")+i}return e},$n=$;function je(){this.handlers=[]}je.prototype.use=function(e,r,n){return this.handlers.push({fulfilled:e,rejected:r,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1},je.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},je.prototype.forEach=function(e){$n.forEach(this.handlers,function(n){n!==null&&e(n)})};var Mn=je,qn=$,Bn=function(e,r){qn.forEach(e,function(i,a){a!==r&&a.toUpperCase()===r.toUpperCase()&&(e[r]=i,delete e[a])})},Jt=$;function fe(t,e,r,n,i){Error.call(this),this.message=t,this.name="AxiosError",e&&(this.code=e),r&&(this.config=r),n&&(this.request=n),i&&(this.response=i)}Jt.inherits(fe,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var zt=fe.prototype,Vt={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED"].forEach(function(t){Vt[t]={value:t}}),Object.defineProperties(fe,Vt),Object.defineProperty(zt,"isAxiosError",{value:!0}),fe.from=function(t,e,r,n,i,a){var o=Object.create(zt);return Jt.toFlatObject(t,o,function(u){return u!==Error.prototype}),fe.call(o,t.message,e,r,n,i),o.name=t.name,a&&Object.assign(o,a),o};var le=fe,Wt={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},X=$;function kn(t,e){e=e||new FormData;var r=[];function n(a){return a===null?"":X.isDate(a)?a.toISOString():X.isArrayBuffer(a)||X.isTypedArray(a)?typeof Blob=="function"?new Blob([a]):Buffer.from(a):a}function i(a,o){if(X.isPlainObject(a)||X.isArray(a)){if(r.indexOf(a)!==-1)throw Error("Circular reference detected in "+o);r.push(a),X.forEach(a,function(u,l){if(!X.isUndefined(u)){var c=o?o+"."+l:l,d;if(u&&!o&&typeof u=="object"){if(X.endsWith(l,"{}"))u=JSON.stringify(u);else if(X.endsWith(l,"[]")&&(d=X.toArray(u))){d.forEach(function(f){!X.isUndefined(f)&&e.append(c,n(f))});return}}i(u,c)}}),r.pop()}else e.append(o,n(a))}return i(t),e}var Xt=kn,st,Gt;function Hn(){if(Gt)return st;Gt=1;var t=le;return st=function(r,n,i){var a=i.config.validateStatus;!i.status||!a||a(i.status)?r(i):n(new t("Request failed with status code "+i.status,[t.ERR_BAD_REQUEST,t.ERR_BAD_RESPONSE][Math.floor(i.status/100)-4],i.config,i.request,i))},st}var ut,Yt;function Jn(){if(Yt)return ut;Yt=1;var t=$;return ut=t.isStandardBrowserEnv()?function(){return{write:function(n,i,a,o,s,u){var l=[];l.push(n+"="+encodeURIComponent(i)),t.isNumber(a)&&l.push("expires="+new Date(a).toGMTString()),t.isString(o)&&l.push("path="+o),t.isString(s)&&l.push("domain="+s),u===!0&&l.push("secure"),document.cookie=l.join("; ")},read:function(n){var i=document.cookie.match(new RegExp("(^|;\\s*)("+n+")=([^;]*)"));return i?decodeURIComponent(i[3]):null},remove:function(n){this.write(n,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}(),ut}var zn=function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)},Vn=function(e,r){return r?e.replace(/\/+$/,"")+"/"+r.replace(/^\/+/,""):e},Wn=zn,Xn=Vn,Kt=function(e,r){return e&&!Wn(r)?Xn(e,r):r},ft,Qt;function Gn(){if(Qt)return ft;Qt=1;var t=$,e=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];return ft=function(n){var i={},a,o,s;return n&&t.forEach(n.split(`
`),function(l){if(s=l.indexOf(":"),a=t.trim(l.substr(0,s)).toLowerCase(),o=t.trim(l.substr(s+1)),a){if(i[a]&&e.indexOf(a)>=0)return;a==="set-cookie"?i[a]=(i[a]?i[a]:[]).concat([o]):i[a]=i[a]?i[a]+", "+o:o}}),i},ft}var lt,Zt;function Yn(){if(Zt)return lt;Zt=1;var t=$;return lt=t.isStandardBrowserEnv()?function(){var r=/(msie|trident)/i.test(navigator.userAgent),n=document.createElement("a"),i;function a(o){var s=o;return r&&(n.setAttribute("href",s),s=n.href),n.setAttribute("href",s),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:n.pathname.charAt(0)==="/"?n.pathname:"/"+n.pathname}}return i=a(window.location.href),function(s){var u=t.isString(s)?a(s):s;return u.protocol===i.protocol&&u.host===i.host}}():function(){return function(){return!0}}(),lt}var ct,er;function Ie(){if(er)return ct;er=1;var t=le,e=$;function r(n){t.call(this,n==null?"canceled":n,t.ERR_CANCELED),this.name="CanceledError"}return e.inherits(r,t,{__CANCEL__:!0}),ct=r,ct}var dt,tr;function Kn(){return tr||(tr=1,dt=function(e){var r=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return r&&r[1]||""}),dt}var ht,rr;function nr(){if(rr)return ht;rr=1;var t=$,e=Hn(),r=Jn(),n=Ht,i=Kt,a=Gn(),o=Yn(),s=Wt,u=le,l=Ie(),c=Kn();return ht=function(f){return new Promise(function(g,m){var S=f.data,A=f.headers,y=f.responseType,w;function T(){f.cancelToken&&f.cancelToken.unsubscribe(w),f.signal&&f.signal.removeEventListener("abort",w)}t.isFormData(S)&&t.isStandardBrowserEnv()&&delete A["Content-Type"];var p=new XMLHttpRequest;if(f.auth){var j=f.auth.username||"",M=f.auth.password?unescape(encodeURIComponent(f.auth.password)):"";A.Authorization="Basic "+btoa(j+":"+M)}var C=i(f.baseURL,f.url);p.open(f.method.toUpperCase(),n(C,f.params,f.paramsSerializer),!0),p.timeout=f.timeout;function B(){if(!!p){var D="getAllResponseHeaders"in p?a(p.getAllResponseHeaders()):null,F=!y||y==="text"||y==="json"?p.responseText:p.response,q={data:F,status:p.status,statusText:p.statusText,headers:D,config:f,request:p};e(function(Ue){g(Ue),T()},function(Ue){m(Ue),T()},q),p=null}}if("onloadend"in p?p.onloadend=B:p.onreadystatechange=function(){!p||p.readyState!==4||p.status===0&&!(p.responseURL&&p.responseURL.indexOf("file:")===0)||setTimeout(B)},p.onabort=function(){!p||(m(new u("Request aborted",u.ECONNABORTED,f,p)),p=null)},p.onerror=function(){m(new u("Network Error",u.ERR_NETWORK,f,p,p)),p=null},p.ontimeout=function(){var F=f.timeout?"timeout of "+f.timeout+"ms exceeded":"timeout exceeded",q=f.transitional||s;f.timeoutErrorMessage&&(F=f.timeoutErrorMessage),m(new u(F,q.clarifyTimeoutError?u.ETIMEDOUT:u.ECONNABORTED,f,p)),p=null},t.isStandardBrowserEnv()){var E=(f.withCredentials||o(C))&&f.xsrfCookieName?r.read(f.xsrfCookieName):void 0;E&&(A[f.xsrfHeaderName]=E)}"setRequestHeader"in p&&t.forEach(A,function(F,q){typeof S>"u"&&q.toLowerCase()==="content-type"?delete A[q]:p.setRequestHeader(q,F)}),t.isUndefined(f.withCredentials)||(p.withCredentials=!!f.withCredentials),y&&y!=="json"&&(p.responseType=f.responseType),typeof f.onDownloadProgress=="function"&&p.addEventListener("progress",f.onDownloadProgress),typeof f.onUploadProgress=="function"&&p.upload&&p.upload.addEventListener("progress",f.onUploadProgress),(f.cancelToken||f.signal)&&(w=function(D){!p||(m(!D||D&&D.type?new l:D),p.abort(),p=null)},f.cancelToken&&f.cancelToken.subscribe(w),f.signal&&(f.signal.aborted?w():f.signal.addEventListener("abort",w))),S||(S=null);var R=c(C);if(R&&["http","https","file"].indexOf(R)===-1){m(new u("Unsupported protocol "+R+":",u.ERR_BAD_REQUEST,f));return}p.send(S)})},ht}var vt,ir;function Qn(){return ir||(ir=1,vt=null),vt}var _=$,ar=Bn,or=le,Zn=Wt,ei=Xt,ti={"Content-Type":"application/x-www-form-urlencoded"};function sr(t,e){!_.isUndefined(t)&&_.isUndefined(t["Content-Type"])&&(t["Content-Type"]=e)}function ri(){var t;return(typeof XMLHttpRequest<"u"||typeof process<"u"&&Object.prototype.toString.call(process)==="[object process]")&&(t=nr()),t}function ni(t,e,r){if(_.isString(t))try{return(e||JSON.parse)(t),_.trim(t)}catch(n){if(n.name!=="SyntaxError")throw n}return(r||JSON.stringify)(t)}var _e={transitional:Zn,adapter:ri(),transformRequest:[function(e,r){if(ar(r,"Accept"),ar(r,"Content-Type"),_.isFormData(e)||_.isArrayBuffer(e)||_.isBuffer(e)||_.isStream(e)||_.isFile(e)||_.isBlob(e))return e;if(_.isArrayBufferView(e))return e.buffer;if(_.isURLSearchParams(e))return sr(r,"application/x-www-form-urlencoded;charset=utf-8"),e.toString();var n=_.isObject(e),i=r&&r["Content-Type"],a;if((a=_.isFileList(e))||n&&i==="multipart/form-data"){var o=this.env&&this.env.FormData;return ei(a?{"files[]":e}:e,o&&new o)}else if(n||i==="application/json")return sr(r,"application/json"),ni(e);return e}],transformResponse:[function(e){var r=this.transitional||_e.transitional,n=r&&r.silentJSONParsing,i=r&&r.forcedJSONParsing,a=!n&&this.responseType==="json";if(a||i&&_.isString(e)&&e.length)try{return JSON.parse(e)}catch(o){if(a)throw o.name==="SyntaxError"?or.from(o,or.ERR_BAD_RESPONSE,this,null,this.response):o}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Qn()},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};_.forEach(["delete","get","head"],function(e){_e.headers[e]={}}),_.forEach(["post","put","patch"],function(e){_e.headers[e]=_.merge(ti)});var pt=_e,ii=$,ai=pt,oi=function(e,r,n){var i=this||ai;return ii.forEach(n,function(o){e=o.call(i,e,r)}),e},yt,ur;function fr(){return ur||(ur=1,yt=function(e){return!!(e&&e.__CANCEL__)}),yt}var lr=$,mt=oi,si=fr(),ui=pt,fi=Ie();function gt(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new fi}var li=function(e){gt(e),e.headers=e.headers||{},e.data=mt.call(e,e.data,e.headers,e.transformRequest),e.headers=lr.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),lr.forEach(["delete","get","head","post","put","patch","common"],function(i){delete e.headers[i]});var r=e.adapter||ui.adapter;return r(e).then(function(i){return gt(e),i.data=mt.call(e,i.data,i.headers,e.transformResponse),i},function(i){return si(i)||(gt(e),i&&i.response&&(i.response.data=mt.call(e,i.response.data,i.response.headers,e.transformResponse))),Promise.reject(i)})},z=$,cr=function(e,r){r=r||{};var n={};function i(c,d){return z.isPlainObject(c)&&z.isPlainObject(d)?z.merge(c,d):z.isPlainObject(d)?z.merge({},d):z.isArray(d)?d.slice():d}function a(c){if(z.isUndefined(r[c])){if(!z.isUndefined(e[c]))return i(void 0,e[c])}else return i(e[c],r[c])}function o(c){if(!z.isUndefined(r[c]))return i(void 0,r[c])}function s(c){if(z.isUndefined(r[c])){if(!z.isUndefined(e[c]))return i(void 0,e[c])}else return i(void 0,r[c])}function u(c){if(c in r)return i(e[c],r[c]);if(c in e)return i(void 0,e[c])}var l={url:o,method:o,data:o,baseURL:s,transformRequest:s,transformResponse:s,paramsSerializer:s,timeout:s,timeoutMessage:s,withCredentials:s,adapter:s,responseType:s,xsrfCookieName:s,xsrfHeaderName:s,onUploadProgress:s,onDownloadProgress:s,decompress:s,maxContentLength:s,maxBodyLength:s,beforeRedirect:s,transport:s,httpAgent:s,httpsAgent:s,cancelToken:s,socketPath:s,responseEncoding:s,validateStatus:u};return z.forEach(Object.keys(e).concat(Object.keys(r)),function(d){var f=l[d]||a,v=f(d);z.isUndefined(v)&&f!==u||(n[d]=v)}),n},St,dr;function hr(){return dr||(dr=1,St={version:"0.27.2"}),St}var ci=hr().version,Z=le,Et={};["object","boolean","number","function","string","symbol"].forEach(function(t,e){Et[t]=function(n){return typeof n===t||"a"+(e<1?"n ":" ")+t}});var vr={};Et.transitional=function(e,r,n){function i(a,o){return"[Axios v"+ci+"] Transitional option '"+a+"'"+o+(n?". "+n:"")}return function(a,o,s){if(e===!1)throw new Z(i(o," has been removed"+(r?" in "+r:"")),Z.ERR_DEPRECATED);return r&&!vr[o]&&(vr[o]=!0,console.warn(i(o," has been deprecated since v"+r+" and will be removed in the near future"))),e?e(a,o,s):!0}};function di(t,e,r){if(typeof t!="object")throw new Z("options must be an object",Z.ERR_BAD_OPTION_VALUE);for(var n=Object.keys(t),i=n.length;i-- >0;){var a=n[i],o=e[a];if(o){var s=t[a],u=s===void 0||o(s,a,t);if(u!==!0)throw new Z("option "+a+" must be "+u,Z.ERR_BAD_OPTION_VALUE);continue}if(r!==!0)throw new Z("Unknown option "+a,Z.ERR_BAD_OPTION)}}var hi={assertOptions:di,validators:Et},pr=$,vi=Ht,yr=Mn,mr=li,Fe=cr,pi=Kt,gr=hi,ce=gr.validators;function de(t){this.defaults=t,this.interceptors={request:new yr,response:new yr}}de.prototype.request=function(e,r){typeof e=="string"?(r=r||{},r.url=e):r=e||{},r=Fe(this.defaults,r),r.method?r.method=r.method.toLowerCase():this.defaults.method?r.method=this.defaults.method.toLowerCase():r.method="get";var n=r.transitional;n!==void 0&&gr.assertOptions(n,{silentJSONParsing:ce.transitional(ce.boolean),forcedJSONParsing:ce.transitional(ce.boolean),clarifyTimeoutError:ce.transitional(ce.boolean)},!1);var i=[],a=!0;this.interceptors.request.forEach(function(v){typeof v.runWhen=="function"&&v.runWhen(r)===!1||(a=a&&v.synchronous,i.unshift(v.fulfilled,v.rejected))});var o=[];this.interceptors.response.forEach(function(v){o.push(v.fulfilled,v.rejected)});var s;if(!a){var u=[mr,void 0];for(Array.prototype.unshift.apply(u,i),u=u.concat(o),s=Promise.resolve(r);u.length;)s=s.then(u.shift(),u.shift());return s}for(var l=r;i.length;){var c=i.shift(),d=i.shift();try{l=c(l)}catch(f){d(f);break}}try{s=mr(l)}catch(f){return Promise.reject(f)}for(;o.length;)s=s.then(o.shift(),o.shift());return s},de.prototype.getUri=function(e){e=Fe(this.defaults,e);var r=pi(e.baseURL,e.url);return vi(r,e.params,e.paramsSerializer)},pr.forEach(["delete","get","head","options"],function(e){de.prototype[e]=function(r,n){return this.request(Fe(n||{},{method:e,url:r,data:(n||{}).data}))}}),pr.forEach(["post","put","patch"],function(e){function r(n){return function(a,o,s){return this.request(Fe(s||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:a,data:o}))}}de.prototype[e]=r(),de.prototype[e+"Form"]=r(!0)});var yi=de,wt,Sr;function mi(){if(Sr)return wt;Sr=1;var t=Ie();function e(r){if(typeof r!="function")throw new TypeError("executor must be a function.");var n;this.promise=new Promise(function(o){n=o});var i=this;this.promise.then(function(a){if(!!i._listeners){var o,s=i._listeners.length;for(o=0;o<s;o++)i._listeners[o](a);i._listeners=null}}),this.promise.then=function(a){var o,s=new Promise(function(u){i.subscribe(u),o=u}).then(a);return s.cancel=function(){i.unsubscribe(o)},s},r(function(o){i.reason||(i.reason=new t(o),n(i.reason))})}return e.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},e.prototype.subscribe=function(n){if(this.reason){n(this.reason);return}this._listeners?this._listeners.push(n):this._listeners=[n]},e.prototype.unsubscribe=function(n){if(!!this._listeners){var i=this._listeners.indexOf(n);i!==-1&&this._listeners.splice(i,1)}},e.source=function(){var n,i=new e(function(o){n=o});return{token:i,cancel:n}},wt=e,wt}var xt,Er;function gi(){return Er||(Er=1,xt=function(e){return function(n){return e.apply(null,n)}}),xt}var At,wr;function Si(){if(wr)return At;wr=1;var t=$;return At=function(r){return t.isObject(r)&&r.isAxiosError===!0},At}var xr=$,Ei=Mt,$e=yi,wi=cr,xi=pt;function Ar(t){var e=new $e(t),r=Ei($e.prototype.request,e);return xr.extend(r,$e.prototype,e),xr.extend(r,e),r.create=function(i){return Ar(wi(t,i))},r}var H=Ar(xi);H.Axios=$e,H.CanceledError=Ie(),H.CancelToken=mi(),H.isCancel=fr(),H.VERSION=hr().version,H.toFormData=Xt,H.AxiosError=le,H.Cancel=H.CanceledError,H.all=function(e){return Promise.all(e)},H.spread=gi(),H.isAxiosError=Si(),et.exports=H,et.exports.default=H,function(t){t.exports=et.exports}(Q);const Or=J(Q.exports);class br{constructor({url:e}){se(this,"url");se(this,"httpClient");se(this,"accessToken");se(this,"adminSecret");this.url=e,this.httpClient=Or.create({baseURL:this.url,maxBodylength:1/0})}async upload(e){const{formData:r}=e;try{return{fileMetadata:(await this.httpClient.post("/files",r,{headers:{...this.generateUploadHeaders(e),...this.generateAuthHeaders(),"Content-Type":"multipart/form-data"}})).data,error:null}}catch(n){return{fileMetadata:null,error:n}}}async getPresignedUrl(e){try{const{fileId:r}=e;return{presignedUrl:(await this.httpClient.get(`/files/${r}/presignedurl`,{headers:{...this.generateAuthHeaders()}})).data,error:null}}catch(r){return{presignedUrl:null,error:r}}}async delete(e){try{const{fileId:r}=e;return await this.httpClient.delete(`/files/${r}`,{headers:{...this.generateAuthHeaders()}}),{error:null}}catch(r){return{error:r}}}setAccessToken(e){return this.accessToken=e,this}setAdminSecret(e){return this.adminSecret=e,this}generateUploadHeaders(e){const{bucketId:r,name:n,id:i}=e,a={};return r&&(a["x-nhost-bucket-id"]=r),i&&(a["x-nhost-file-id"]=i),n&&(a["x-nhost-file-name"]=n),a}generateAuthHeaders(){return!this.adminSecret&&!this.accessToken?null:this.adminSecret?{"x-hasura-admin-secret":this.adminSecret}:{Authorization:`Bearer ${this.accessToken}`}}}var Ai=typeof self=="object"?self.FormData:window.FormData;class Oi{constructor({url:e,adminSecret:r}){se(this,"url");se(this,"api");this.url=e,this.api=new br({url:e}),this.setAdminSecret(r)}async upload(e){let r;"file"in e?(r=new Ai,r.append("file",e.file)):r=e.formData;const{fileMetadata:n,error:i}=await this.api.upload({...e,formData:r});return i?{fileMetadata:null,error:i}:n?{fileMetadata:n,error:null}:{fileMetadata:null,error:new Error("Invalid file returned")}}getUrl(e){return this.getPublicUrl(e)}getPublicUrl(e){const{fileId:r}=e;return`${this.url}/files/${r}`}async getPresignedUrl(e){const{presignedUrl:r,error:n}=await this.api.getPresignedUrl(e);return n?{presignedUrl:null,error:n}:r?{presignedUrl:r,error:null}:{presignedUrl:null,error:new Error("Invalid file id")}}async delete(e){const{error:r}=await this.api.delete(e);return r?{error:r}:{error:null}}setAccessToken(e){return this.api.setAccessToken(e),this}setAdminSecret(e){return this.api.setAdminSecret(e),this}}/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var h=function(){return h=Object.assign||function(e){for(var r,n=1,i=arguments.length;n<i;n++){r=arguments[n];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e},h.apply(this,arguments)};function Ot(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(t);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(t,n[i])&&(r[n[i]]=t[n[i]]);return r}function N(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function x(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),i,a=[],o;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)a.push(i.value)}catch(s){o={error:s}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(o)throw o.error}}return a}function P(t,e,r){if(r||arguments.length===2)for(var n=0,i=e.length,a;n<i;n++)(a||!(n in e))&&(a||(a=Array.prototype.slice.call(e,0,n)),a[n]=e[n]);return t.concat(a||Array.prototype.slice.call(e))}var b;(function(t){t.Start="xstate.start",t.Stop="xstate.stop",t.Raise="xstate.raise",t.Send="xstate.send",t.Cancel="xstate.cancel",t.NullEvent="",t.Assign="xstate.assign",t.After="xstate.after",t.DoneState="done.state",t.DoneInvoke="done.invoke",t.Log="xstate.log",t.Init="xstate.init",t.Invoke="xstate.invoke",t.ErrorExecution="error.execution",t.ErrorCommunication="error.communication",t.ErrorPlatform="error.platform",t.ErrorCustom="xstate.error",t.Update="xstate.update",t.Pure="xstate.pure",t.Choose="xstate.choose"})(b||(b={}));var ee;(function(t){t.Parent="#_parent",t.Internal="#_internal"})(ee||(ee={}));var bt=b.Start,Rt=b.Stop,he=b.Raise,we=b.Send,Rr=b.Cancel,Pr=b.NullEvent,Me=b.Assign,bi=b.After,Ri=b.DoneState,Pt=b.Log,Tr=b.Init,qe=b.Invoke,Pi=b.ErrorExecution,Ti=b.ErrorPlatform,Nr=b.ErrorCustom,Tt=b.Update,Dr=b.Choose,Ur=b.Pure;const Ni=Object.freeze(Object.defineProperty({__proto__:null,after:bi,assign:Me,cancel:Rr,choose:Dr,doneState:Ri,error:Nr,errorExecution:Pi,errorPlatform:Ti,init:Tr,invoke:qe,log:Pt,nullEvent:Pr,pure:Ur,raise:he,send:we,start:bt,stop:Rt,update:Tt},Symbol.toStringTag,{value:"Module"}));var Cr=".",Lr={},Nt="xstate.guard",Di="",V=process.env.NODE_ENV==="production",Be;function Dt(t,e,r){r===void 0&&(r=Cr);var n=xe(t,r),i=xe(e,r);return O(i)?O(n)?i===n:!1:O(n)?n in i:Object.keys(n).every(function(a){return a in i?Dt(n[a],i[a]):!1})}function jr(t){try{return O(t)||typeof t=="number"?"".concat(t):t.type}catch{throw new Error("Events must be strings or objects with a string event.type property.")}}function Ut(t,e){try{return Oe(t)?t:t.toString().split(e)}catch{throw new Error("'".concat(t,"' is not a valid state path."))}}function Ui(t){return typeof t=="object"&&"value"in t&&"context"in t&&"event"in t&&"_event"in t}function xe(t,e){if(Ui(t))return t.value;if(Oe(t))return ke(t);if(typeof t!="string")return t;var r=Ut(t,e);return ke(r)}function ke(t){if(t.length===1)return t[0];for(var e={},r=e,n=0;n<t.length-1;n++)n===t.length-2?r[t[n]]=t[n+1]:(r[t[n]]={},r=r[t[n]]);return e}function Ae(t,e){for(var r={},n=Object.keys(t),i=0;i<n.length;i++){var a=n[i];r[a]=e(t[a],a,t,i)}return r}function Ir(t,e,r){var n,i,a={};try{for(var o=N(Object.keys(t)),s=o.next();!s.done;s=o.next()){var u=s.value,l=t[u];!r(l)||(a[u]=e(l,u,t))}}catch(c){n={error:c}}finally{try{s&&!s.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}return a}var Ci=function(t){return function(e){var r,n,i=e;try{for(var a=N(t),o=a.next();!o.done;o=a.next()){var s=o.value;i=i[s]}}catch(u){r={error:u}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}return i}};function Li(t,e){return function(r){var n,i,a=r;try{for(var o=N(t),s=o.next();!s.done;s=o.next()){var u=s.value;a=a[e][u]}}catch(l){n={error:l}}finally{try{s&&!s.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}return a}}function He(t){if(!t)return[[]];if(O(t))return[[t]];var e=U(Object.keys(t).map(function(r){var n=t[r];return typeof n!="string"&&(!n||!Object.keys(n).length)?[[r]]:He(t[r]).map(function(i){return[r].concat(i)})}));return e}function U(t){var e;return(e=[]).concat.apply(e,P([],x(t),!1))}function _r(t){return Oe(t)?t:[t]}function G(t){return t===void 0?[]:_r(t)}function Fr(t,e,r){var n,i;if(L(t))return t(e,r.data);var a={};try{for(var o=N(Object.keys(t)),s=o.next();!s.done;s=o.next()){var u=s.value,l=t[u];L(l)?a[u]=l(e,r.data):a[u]=l}}catch(c){n={error:c}}finally{try{s&&!s.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}return a}function ji(t){return/^(done|error)\./.test(t)}function Ii(t,e){var r,n,i=x([[],[]],2),a=i[0],o=i[1];try{for(var s=N(t),u=s.next();!u.done;u=s.next()){var l=u.value;e(l)?a.push(l):o.push(l)}}catch(c){r={error:c}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}return[a,o]}function $r(t,e){return Ae(t.states,function(r,n){if(!!r){var i=(O(e)?void 0:e[n])||(r?r.current:void 0);if(!!i)return{current:i,states:$r(r,i)}}})}function _i(t,e){return{current:e,states:$r(t,e)}}function Mr(t,e,r,n){V||K(!!t,"Attempting to update undefined context");var i=t&&r.reduce(function(a,o){var s,u,l=o.assignment,c={state:n,action:o,_event:e},d={};if(L(l))d=l(a,e.data,c);else try{for(var f=N(Object.keys(l)),v=f.next();!v.done;v=f.next()){var g=v.value,m=l[g];d[g]=L(m)?m(a,e.data,c):m}}catch(S){s={error:S}}finally{try{v&&!v.done&&(u=f.return)&&u.call(f)}finally{if(s)throw s.error}}return Object.assign({},a,d)},t);return i}var K=function(){};V||(K=function(t,e){var r=t instanceof Error?t:void 0;if(!(!r&&t)&&console!==void 0){var n=["Warning: ".concat(e)];r&&n.push(r),console.warn.apply(console,n)}});function Oe(t){return Array.isArray(t)}function L(t){return typeof t=="function"}function O(t){return typeof t=="string"}function qr(t,e){if(!!t)return O(t)?{type:Nt,name:t,predicate:e?e[t]:void 0}:L(t)?{type:Nt,name:t.name,predicate:t}:t}var Br=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();Be={},Be[Br]=function(){return this},Be[Symbol.observable]=function(){return this};function oe(t){return!!t&&"__xstatenode"in t}var Fi=function(){var t=0;return function(){return t++,t.toString(16)}}();function kr(t,e){return O(t)||typeof t=="number"?h({type:t},e):t}function be(t,e){if(!O(t)&&"$$type"in t&&t.$$type==="scxml")return t;var r=kr(t);return h({name:r.type,data:r,$$type:"scxml",type:"external"},e)}function ve(t,e){var r=_r(e).map(function(n){return typeof n>"u"||typeof n=="string"||oe(n)?{target:n,event:t}:h(h({},n),{event:t})});return r}function $i(t){if(!(t===void 0||t===Di))return G(t)}function Hr(t,e,r,n,i){var a=t.options.guards,o={state:i,cond:e,_event:n};if(e.type===Nt)return((a==null?void 0:a[e.name])||e.predicate)(r,n.data,o);var s=a==null?void 0:a[e.type];if(!s)throw new Error("Guard '".concat(e.type,"' is not implemented on machine '").concat(t.id,"'."));return s(r,n.data,o)}function Mi(t){return typeof t=="string"?{type:t}:t}function Je(t,e){return"".concat(t,":invocation[").concat(e,"]")}var ze=be({type:Tr});function Ct(t,e){return e&&e[t]||void 0}function pe(t,e){var r;if(O(t)||typeof t=="number"){var n=Ct(t,e);L(n)?r={type:t,exec:n}:n?r=n:r={type:t,exec:void 0}}else if(L(t))r={type:t.name||t.toString(),exec:t};else{var n=Ct(t.type,e);if(L(n))r=h(h({},t),{exec:n});else if(n){var i=n.type||t.type;r=h(h(h({},n),t),{type:i})}else r=t}return r}var te=function(t,e){if(!t)return[];var r=Oe(t)?t:[t];return r.map(function(n){return pe(n,e)})};function Ve(t){var e=pe(t);return h(h({id:O(t)?t:e.id},e),{type:e.type})}function Jr(t){return O(t)?{type:he,event:t}:re(t,{to:ee.Internal})}function zr(t){return{type:he,_event:be(t.event)}}function re(t,e){return{to:e?e.to:void 0,type:we,event:L(t)?t:kr(t),delay:e?e.delay:void 0,id:e&&e.id!==void 0?e.id:L(t)?t.name:jr(t)}}function Vr(t,e,r,n){var i={_event:r},a=be(L(t.event)?t.event(e,r.data,i):t.event),o;if(O(t.delay)){var s=n&&n[t.delay];o=L(s)?s(e,r.data,i):s}else o=L(t.delay)?t.delay(e,r.data,i):t.delay;var u=L(t.to)?t.to(e,r.data,i):t.to;return h(h({},t),{to:u,_event:a,event:a.data,delay:o})}function Lt(t,e){return re(t,h(h({},e),{to:ee.Parent}))}function qi(t,e,r){return re(e,h(h({},r),{to:t}))}function Bi(){return Lt(Tt)}function ki(t,e){return re(t,h(h({},e),{to:function(r,n,i){var a=i._event;return a.origin}}))}var Hi=function(t,e){return{context:t,event:e}};function Ji(t,e){return t===void 0&&(t=Hi),{type:Pt,label:e,expr:t}}var Wr=function(t,e,r){return h(h({},t),{value:O(t.expr)?t.expr:t.expr(e,r.data,{_event:r})})},Xr=function(t){return{type:Rr,sendId:t}};function Gr(t){var e=Ve(t);return{type:b.Start,activity:e,exec:void 0}}function Yr(t){var e=L(t)?t:Ve(t);return{type:b.Stop,activity:e,exec:void 0}}function Kr(t,e,r){var n=L(t.activity)?t.activity(e,r.data):t.activity,i=typeof n=="string"?{id:n}:n,a={type:b.Stop,activity:i};return a}var Qr=function(t){return{type:Me,assignment:t}};function zi(t){return typeof t=="object"&&"type"in t}function Zr(t,e){var r=e?"#".concat(e):"";return"".concat(b.After,"(").concat(t,")").concat(r)}function Re(t,e){var r="".concat(b.DoneState,".").concat(t),n={type:r,data:e};return n.toString=function(){return r},n}function en(t,e){var r="".concat(b.DoneInvoke,".").concat(t),n={type:r,data:e};return n.toString=function(){return r},n}function tn(t,e){var r="".concat(b.ErrorPlatform,".").concat(t),n={type:r,data:e};return n.toString=function(){return r},n}function Vi(t){return{type:b.Pure,get:t}}function Wi(t,e){if(!V&&(!t||typeof t=="function")){var r=t;t=function(){for(var n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];var a=typeof r=="function"?r.apply(void 0,P([],x(n),!1)):r;if(!a)throw new Error("Attempted to forward event to undefined actor. This risks an infinite loop in the sender.");return a}}return re(function(n,i){return i},h(h({},e),{to:t}))}function Xi(t,e){return Lt(function(r,n,i){return{type:Nr,data:L(t)?t(r,n,i):t}},h(h({},e),{to:ee.Parent}))}function Gi(t){return{type:b.Choose,conds:t}}var Yi=function(t){var e,r,n=[];try{for(var i=N(t),a=i.next();!a.done;a=i.next())for(var o=a.value,s=0;s<o.length;){if(o[s].type===Me){n.push(o[s]),o.splice(s,1);continue}s++}}catch(u){e={error:u}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(e)throw e.error}}return n};function We(t,e,r,n,i,a,o){o===void 0&&(o=!1);var s=o?[]:Yi(i),u=s.length?Mr(r,n,s,e):r,l=o?[r]:void 0,c=[];function d(g){var m;switch(g.type){case he:return zr(g);case we:var S=Vr(g,u,n,t.options.delays);return V||K(!O(g.delay)||typeof S.delay=="number","No delay reference for delay expression '".concat(g.delay,"' was found on machine '").concat(t.id,"'")),a&&S.to!==ee.Internal&&c.push(S),S;case Pt:{var A=Wr(g,u,n);return a==null||a(A,u,n),A}case Dr:{var y=g,w=(m=y.conds.find(function(F){var q=qr(F.cond,t.options.guards);return!q||Hr(t,q,u,n,a?void 0:e)}))===null||m===void 0?void 0:m.actions;if(!w)return[];var T=x(We(t,e,u,n,[te(G(w),t.options.actions)],a,o),2),p=T[0],j=T[1];return u=j,l==null||l.push(u),p}case Ur:{var w=g.get(u,n.data);if(!w)return[];var M=x(We(t,e,u,n,[te(G(w),t.options.actions)],a,o),2),C=M[0],B=M[1];return u=B,l==null||l.push(u),C}case Rt:{var A=Kr(g,u,n);return a==null||a(A,r,n),A}case Me:{u=Mr(u,n,[g],a?void 0:e),l==null||l.push(u);break}default:var E=pe(g,t.options.actions),R=E.exec;if(a)a(E,u,n);else if(R&&l){var D=l.length-1;E=h(h({},E),{exec:function(F){for(var q=[],ie=1;ie<arguments.length;ie++)q[ie-1]=arguments[ie];R.apply(void 0,P([l[D]],x(q),!1))}})}return E}}function f(g){var m,S,A=[];try{for(var y=N(g),w=y.next();!w.done;w=y.next()){var T=w.value,p=d(T);p&&(A=A.concat(p))}}catch(j){m={error:j}}finally{try{w&&!w.done&&(S=y.return)&&S.call(y)}finally{if(m)throw m.error}}return c.forEach(function(j){a(j,u,n)}),c.length=0,A}var v=U(i.map(f));return[v,u]}const Ki=Object.freeze(Object.defineProperty({__proto__:null,actionTypes:Ni,after:Zr,assign:Qr,cancel:Xr,choose:Gi,done:Re,doneInvoke:en,error:tn,escalate:Xi,forwardTo:Wi,getActionFunction:Ct,initEvent:ze,isActionObject:zi,log:Ji,pure:Vi,raise:Jr,resolveActions:We,resolveLog:Wr,resolveRaise:zr,resolveSend:Vr,resolveStop:Kr,respond:ki,send:re,sendParent:Lt,sendTo:qi,sendUpdate:Bi,start:Gr,stop:Yr,toActionObject:pe,toActionObjects:te,toActivityDefinition:Ve},Symbol.toStringTag,{value:"Module"}));var Xe=[],Qi=function(t,e){Xe.push(t);var r=e(t);return Xe.pop(),r},Zi=function(t){return t(Xe[Xe.length-1])};function rn(t){var e;return e={id:t,send:function(){},subscribe:function(){return{unsubscribe:function(){}}},getSnapshot:function(){},toJSON:function(){return{id:t}}},e[Br]=function(){return this},e}function ea(t,e,r,n){var i,a=Mi(t.src),o=(i=e==null?void 0:e.options.services)===null||i===void 0?void 0:i[a.type],s=t.data?Fr(t.data,r,n):void 0,u=o?nn(o,t.id,s):rn(t.id);return u.meta=t,u}function nn(t,e,r){var n=rn(e);if(n.deferred=!0,oe(t)){var i=n.state=Qi(void 0,function(){return(r?t.withContext(r):t).initialState});n.getSnapshot=function(){return i}}return n}var Ge=function(t){return t.type==="atomic"||t.type==="final"};function an(t){return Object.keys(t.states).map(function(e){return t.states[e]})}function Pe(t){return an(t).filter(function(e){return e.type!=="history"})}function on(t){var e=[t];return Ge(t)?e:e.concat(U(Pe(t).map(on)))}function Te(t,e){var r,n,i,a,o,s,u,l,c=new Set(t),d=jt(c),f=new Set(e);try{for(var v=N(f),g=v.next();!g.done;g=v.next())for(var m=g.value,S=m.parent;S&&!f.has(S);)f.add(S),S=S.parent}catch(B){r={error:B}}finally{try{g&&!g.done&&(n=v.return)&&n.call(v)}finally{if(r)throw r.error}}var A=jt(f);try{for(var y=N(f),w=y.next();!w.done;w=y.next()){var m=w.value;if(m.type==="compound"&&(!A.get(m)||!A.get(m).length))d.get(m)?d.get(m).forEach(function(E){return f.add(E)}):m.initialStateNodes.forEach(function(E){return f.add(E)});else if(m.type==="parallel")try{for(var T=(o=void 0,N(Pe(m))),p=T.next();!p.done;p=T.next()){var j=p.value;f.has(j)||(f.add(j),d.get(j)?d.get(j).forEach(function(E){return f.add(E)}):j.initialStateNodes.forEach(function(E){return f.add(E)}))}}catch(E){o={error:E}}finally{try{p&&!p.done&&(s=T.return)&&s.call(T)}finally{if(o)throw o.error}}}}catch(B){i={error:B}}finally{try{w&&!w.done&&(a=y.return)&&a.call(y)}finally{if(i)throw i.error}}try{for(var M=N(f),C=M.next();!C.done;C=M.next())for(var m=C.value,S=m.parent;S&&!f.has(S);)f.add(S),S=S.parent}catch(B){u={error:B}}finally{try{C&&!C.done&&(l=M.return)&&l.call(M)}finally{if(u)throw u.error}}return f}function sn(t,e){var r=e.get(t);if(!r)return{};if(t.type==="compound"){var n=r[0];if(n){if(Ge(n))return n.key}else return{}}var i={};return r.forEach(function(a){i[a.key]=sn(a,e)}),i}function jt(t){var e,r,n=new Map;try{for(var i=N(t),a=i.next();!a.done;a=i.next()){var o=a.value;n.has(o)||n.set(o,[]),o.parent&&(n.has(o.parent)||n.set(o.parent,[]),n.get(o.parent).push(o))}}catch(s){e={error:s}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(e)throw e.error}}return n}function ta(t,e){var r=Te([t],e);return sn(t,jt(r))}function Ne(t,e){return Array.isArray(t)?t.some(function(r){return r===e}):t instanceof Set?t.has(e):!1}function ra(t){return P([],x(new Set(U(P([],x(t.map(function(e){return e.ownEvents})),!1)))),!1)}function Ye(t,e){return e.type==="compound"?Pe(e).some(function(r){return r.type==="final"&&Ne(t,r)}):e.type==="parallel"?Pe(e).every(function(r){return Ye(t,r)}):!1}function na(t){return t===void 0&&(t=[]),t.reduce(function(e,r){return r.meta!==void 0&&(e[r.id]=r.meta),e},{})}function un(t){return new Set(U(t.map(function(e){return e.tags})))}function fn(t,e){if(t===e)return!0;if(t===void 0||e===void 0)return!1;if(O(t)||O(e))return t===e;var r=Object.keys(t),n=Object.keys(e);return r.length===n.length&&r.every(function(i){return fn(t[i],e[i])})}var ne=function(){function t(e){var r=this,n;this.actions=[],this.activities=Lr,this.meta={},this.events=[],this.value=e.value,this.context=e.context,this._event=e._event,this._sessionid=e._sessionid,this.event=this._event.data,this.historyValue=e.historyValue,this.history=e.history,this.actions=e.actions||[],this.activities=e.activities||Lr,this.meta=na(e.configuration),this.events=e.events||[],this.matches=this.matches.bind(this),this.toStrings=this.toStrings.bind(this),this.configuration=e.configuration,this.transitions=e.transitions,this.children=e.children,this.done=!!e.done,this.tags=(n=Array.isArray(e.tags)?new Set(e.tags):e.tags)!==null&&n!==void 0?n:new Set,this.machine=e.machine,Object.defineProperty(this,"nextEvents",{get:function(){return ra(r.configuration)}})}return t.from=function(e,r){if(e instanceof t)return e.context!==r?new t({value:e.value,context:r,_event:e._event,_sessionid:null,historyValue:e.historyValue,history:e.history,actions:[],activities:e.activities,meta:{},events:[],configuration:[],transitions:[],children:{}}):e;var n=ze;return new t({value:e,context:r,_event:n,_sessionid:null,historyValue:void 0,history:void 0,actions:[],activities:void 0,meta:void 0,events:[],configuration:[],transitions:[],children:{}})},t.create=function(e){return new t(e)},t.inert=function(e,r){if(e instanceof t){if(!e.actions.length)return e;var n=ze;return new t({value:e.value,context:r,_event:n,_sessionid:null,historyValue:e.historyValue,history:e.history,activities:e.activities,configuration:e.configuration,transitions:[],children:{}})}return t.from(e,r)},t.prototype.toStrings=function(e,r){var n=this;if(e===void 0&&(e=this.value),r===void 0&&(r="."),O(e))return[e];var i=Object.keys(e);return i.concat.apply(i,P([],x(i.map(function(a){return n.toStrings(e[a],r).map(function(o){return a+r+o})})),!1))},t.prototype.toJSON=function(){var e=this;e.configuration,e.transitions;var r=e.tags;e.machine;var n=Ot(e,["configuration","transitions","tags","machine"]);return h(h({},n),{tags:Array.from(r)})},t.prototype.matches=function(e){return Dt(e,this.value)},t.prototype.hasTag=function(e){return this.tags.has(e)},t.prototype.can=function(e){var r;V&&K(!!this.machine,"state.can(...) used outside of a machine-created State object; this will always return false.");var n=(r=this.machine)===null||r===void 0?void 0:r.getTransitionData(this,e);return!!(n!=null&&n.transitions.length)&&n.transitions.some(function(i){return i.target!==void 0||i.actions.length})},t}(),ln={sync:!1,autoForward:!1},cn;(function(t){t[t.NotStarted=0]="NotStarted",t[t.Running=1]="Running",t[t.Stopped=2]="Stopped"})(cn||(cn={}));var ia=function(t){return O(t)?h(h({},ln),{name:t}):h(h(h({},ln),{name:Fi()}),t)};function aa(t,e){var r=ia(e);return Zi(function(n){if(!V){var i=oe(t)||L(t);K(!!n||i,'Attempted to spawn an Actor (ID: "'.concat(oe(t)?t.id:"undefined",'") outside of a service. This will have no effect.'))}return n?n.spawn(t,r.name,r):nn(t,r.name)})}function oa(t){if(typeof t=="string"){var e={type:t};return e.toString=function(){return t},e}return t}function Ke(t){return h(h({type:qe},t),{toJSON:function(){t.onDone,t.onError;var e=Ot(t,["onDone","onError"]);return h(h({},e),{type:qe,src:oa(t.src)})}})}var ye="",It="#",De="*",me={},ge=function(t){return t[0]===It},sa=function(){return{actions:{},guards:{},services:{},activities:{},delays:{}}},ua=function(t,e,r){var n=r.slice(0,-1).some(function(a){return!("cond"in a)&&!("in"in a)&&(O(a.target)||oe(a.target))}),i=e===ye?"the transient event":"event '".concat(e,"'");K(!n,"One or more transitions for ".concat(i," on state '").concat(t.id,"' are unreachable. ")+"Make sure that the default transition is the last one defined.")},fa=function(){function t(e,r,n,i){n===void 0&&(n="context"in e?e.context:void 0);var a=this,o;this.config=e,this._context=n,this.order=-1,this.__xstatenode=!0,this.__cache={events:void 0,relativeValue:new Map,initialStateValue:void 0,initialState:void 0,on:void 0,transitions:void 0,candidates:{},delayedTransitions:void 0},this.idMap={},this.tags=[],this.options=Object.assign(sa(),r),this.parent=i==null?void 0:i.parent,this.key=this.config.key||(i==null?void 0:i.key)||this.config.id||"(machine)",this.machine=this.parent?this.parent.machine:this,this.path=this.parent?this.parent.path.concat(this.key):[],this.delimiter=this.config.delimiter||(this.parent?this.parent.delimiter:Cr),this.id=this.config.id||P([this.machine.key],x(this.path),!1).join(this.delimiter),this.version=this.parent?this.parent.version:this.config.version,this.type=this.config.type||(this.config.parallel?"parallel":this.config.states&&Object.keys(this.config.states).length?"compound":this.config.history?"history":"atomic"),this.schema=this.parent?this.machine.schema:(o=this.config.schema)!==null&&o!==void 0?o:{},this.description=this.config.description,V||K(!("parallel"in this.config),'The "parallel" property is deprecated and will be removed in version 4.1. '.concat(this.config.parallel?"Replace with `type: 'parallel'`":"Use `type: '".concat(this.type,"'`")," in the config for state node '").concat(this.id,"' instead.")),this.initial=this.config.initial,this.states=this.config.states?Ae(this.config.states,function(l,c){var d,f=new t(l,{},void 0,{parent:a,key:c});return Object.assign(a.idMap,h((d={},d[f.id]=f,d),f.idMap)),f}):me;var s=0;function u(l){var c,d;l.order=s++;try{for(var f=N(an(l)),v=f.next();!v.done;v=f.next()){var g=v.value;u(g)}}catch(m){c={error:m}}finally{try{v&&!v.done&&(d=f.return)&&d.call(f)}finally{if(c)throw c.error}}}u(this),this.history=this.config.history===!0?"shallow":this.config.history||!1,this._transient=!!this.config.always||(this.config.on?Array.isArray(this.config.on)?this.config.on.some(function(l){var c=l.event;return c===ye}):ye in this.config.on:!1),this.strict=!!this.config.strict,this.onEntry=G(this.config.entry||this.config.onEntry).map(function(l){return pe(l)}),this.onExit=G(this.config.exit||this.config.onExit).map(function(l){return pe(l)}),this.meta=this.config.meta,this.doneData=this.type==="final"?this.config.data:void 0,this.invoke=G(this.config.invoke).map(function(l,c){var d,f;if(oe(l)){var v=Je(a.id,c);return a.machine.options.services=h((d={},d[v]=l,d),a.machine.options.services),Ke({src:v,id:v})}else if(O(l.src)){var v=l.id||Je(a.id,c);return Ke(h(h({},l),{id:v,src:l.src}))}else if(oe(l.src)||L(l.src)){var v=l.id||Je(a.id,c);return a.machine.options.services=h((f={},f[v]=l.src,f),a.machine.options.services),Ke(h(h({id:v},l),{src:v}))}else{var g=l.src;return Ke(h(h({id:Je(a.id,c)},l),{src:g}))}}),this.activities=G(this.config.activities).concat(this.invoke).map(function(l){return Ve(l)}),this.transition=this.transition.bind(this),this.tags=G(this.config.tags)}return t.prototype._init=function(){this.__cache.transitions||on(this).forEach(function(e){return e.on})},t.prototype.withConfig=function(e,r){var n=this.options,i=n.actions,a=n.activities,o=n.guards,s=n.services,u=n.delays;return new t(this.config,{actions:h(h({},i),e.actions),activities:h(h({},a),e.activities),guards:h(h({},o),e.guards),services:h(h({},s),e.services),delays:h(h({},u),e.delays)},r!=null?r:this.context)},t.prototype.withContext=function(e){return new t(this.config,this.options,e)},Object.defineProperty(t.prototype,"context",{get:function(){return L(this._context)?this._context():this._context},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"definition",{get:function(){return{id:this.id,key:this.key,version:this.version,context:this.context,type:this.type,initial:this.initial,history:this.history,states:Ae(this.states,function(e){return e.definition}),on:this.on,transitions:this.transitions,entry:this.onEntry,exit:this.onExit,activities:this.activities||[],meta:this.meta,order:this.order||-1,data:this.doneData,invoke:this.invoke,description:this.description,tags:this.tags}},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return this.definition},Object.defineProperty(t.prototype,"on",{get:function(){if(this.__cache.on)return this.__cache.on;var e=this.transitions;return this.__cache.on=e.reduce(function(r,n){return r[n.eventType]=r[n.eventType]||[],r[n.eventType].push(n),r},{})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"after",{get:function(){return this.__cache.delayedTransitions||(this.__cache.delayedTransitions=this.getDelayedTransitions(),this.__cache.delayedTransitions)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"transitions",{get:function(){return this.__cache.transitions||(this.__cache.transitions=this.formatTransitions(),this.__cache.transitions)},enumerable:!1,configurable:!0}),t.prototype.getCandidates=function(e){if(this.__cache.candidates[e])return this.__cache.candidates[e];var r=e===ye,n=this.transitions.filter(function(i){var a=i.eventType===e;return r?a:a||i.eventType===De});return this.__cache.candidates[e]=n,n},t.prototype.getDelayedTransitions=function(){var e=this,r=this.config.after;if(!r)return[];var n=function(a,o){var s=L(a)?"".concat(e.id,":delay[").concat(o,"]"):a,u=Zr(s,e.id);return e.onEntry.push(re(u,{delay:a})),e.onExit.push(Xr(u)),u},i=Oe(r)?r.map(function(a,o){var s=n(a.delay,o);return h(h({},a),{event:s})}):U(Object.keys(r).map(function(a,o){var s=r[a],u=O(s)?{target:s}:s,l=isNaN(+a)?a:+a,c=n(l,o);return G(u).map(function(d){return h(h({},d),{event:c,delay:l})})}));return i.map(function(a){var o=a.delay;return h(h({},e.formatTransition(a)),{delay:o})})},t.prototype.getStateNodes=function(e){var r,n=this;if(!e)return[];var i=e instanceof ne?e.value:xe(e,this.delimiter);if(O(i)){var a=this.getStateNode(i).initial;return a!==void 0?this.getStateNodes((r={},r[i]=a,r)):[this,this.states[i]]}var o=Object.keys(i),s=[this];return s.push.apply(s,P([],x(U(o.map(function(u){return n.getStateNode(u).getStateNodes(i[u])}))),!1)),s},t.prototype.handles=function(e){var r=jr(e);return this.events.includes(r)},t.prototype.resolveState=function(e){var r=e instanceof ne?e:ne.create(e),n=Array.from(Te([],this.getStateNodes(r.value)));return new ne(h(h({},r),{value:this.resolve(r.value),configuration:n,done:Ye(n,this),tags:un(n),machine:this.machine}))},t.prototype.transitionLeafNode=function(e,r,n){var i=this.getStateNode(e),a=i.next(r,n);return!a||!a.transitions.length?this.next(r,n):a},t.prototype.transitionCompoundNode=function(e,r,n){var i=Object.keys(e),a=this.getStateNode(i[0]),o=a._transition(e[i[0]],r,n);return!o||!o.transitions.length?this.next(r,n):o},t.prototype.transitionParallelNode=function(e,r,n){var i,a,o={};try{for(var s=N(Object.keys(e)),u=s.next();!u.done;u=s.next()){var l=u.value,c=e[l];if(!!c){var d=this.getStateNode(l),f=d._transition(c,r,n);f&&(o[l]=f)}}}catch(y){i={error:y}}finally{try{u&&!u.done&&(a=s.return)&&a.call(s)}finally{if(i)throw i.error}}var v=Object.keys(o).map(function(y){return o[y]}),g=U(v.map(function(y){return y.transitions})),m=v.some(function(y){return y.transitions.length>0});if(!m)return this.next(r,n);var S=U(v.map(function(y){return y.entrySet})),A=U(Object.keys(o).map(function(y){return o[y].configuration}));return{transitions:g,entrySet:S,exitSet:U(v.map(function(y){return y.exitSet})),configuration:A,source:r,actions:U(Object.keys(o).map(function(y){return o[y].actions}))}},t.prototype._transition=function(e,r,n){return O(e)?this.transitionLeafNode(e,r,n):Object.keys(e).length===1?this.transitionCompoundNode(e,r,n):this.transitionParallelNode(e,r,n)},t.prototype.getTransitionData=function(e,r){return this._transition(e.value,e,be(r))},t.prototype.next=function(e,r){var n,i,a=this,o=r.name,s=[],u=[],l;try{for(var c=N(this.getCandidates(o)),d=c.next();!d.done;d=c.next()){var f=d.value,v=f.cond,g=f.in,m=e.context,S=g?O(g)&&ge(g)?e.matches(xe(this.getStateNodeById(g).path,this.delimiter)):Dt(xe(g,this.delimiter),Ci(this.path.slice(0,-2))(e.value)):!0,A=!1;try{A=!v||Hr(this.machine,v,m,r,e)}catch(p){throw new Error("Unable to evaluate guard '".concat(v.name||v.type,"' in transition for event '").concat(o,"' in state node '").concat(this.id,`':
`).concat(p.message))}if(A&&S){f.target!==void 0&&(u=f.target),s.push.apply(s,P([],x(f.actions),!1)),l=f;break}}}catch(p){n={error:p}}finally{try{d&&!d.done&&(i=c.return)&&i.call(c)}finally{if(n)throw n.error}}if(!!l){if(!u.length)return{transitions:[l],entrySet:[],exitSet:[],configuration:e.value?[this]:[],source:e,actions:s};var y=U(u.map(function(p){return a.getRelativeStateNodes(p,e.historyValue)})),w=!!l.internal,T=[];return w||u.forEach(function(p){T.push.apply(T,P([],x(a.getExternalReentryNodes(p)),!1))}),{transitions:[l],entrySet:T,exitSet:w?[]:[this],configuration:y,source:e,actions:s}}},t.prototype.getExternalReentryNodes=function(e){for(var r=[],n=x(e.order>this.order?[e,this]:[this,e],2),i=n[0],a=n[1];i&&i!==a;)r.push(i),i=i.parent;return i!==a?[]:(r.push(a),r)},t.prototype.getActions=function(e,r,n,i,a,o,s){var u,l,c,d,f=this,v=Te([],o?this.getStateNodes(o.value):[this]);try{for(var g=N(e),m=g.next();!m.done;m=g.next()){var S=m.value;(!Ne(v,S)||Ne(n.entrySet,S.parent))&&n.entrySet.push(S)}}catch(E){u={error:E}}finally{try{m&&!m.done&&(l=g.return)&&l.call(g)}finally{if(u)throw u.error}}try{for(var A=N(v),y=A.next();!y.done;y=A.next()){var S=y.value;(!Ne(e,S)||Ne(n.exitSet,S.parent))&&n.exitSet.push(S)}}catch(E){c={error:E}}finally{try{y&&!y.done&&(d=A.return)&&d.call(A)}finally{if(c)throw c.error}}var w=U(n.entrySet.map(function(E){var R=[];if(E.type!=="final")return R;var D=E.parent;if(!D.parent)return R;R.push(Re(E.id,E.doneData),Re(D.id,E.doneData?Fr(E.doneData,i,a):void 0));var F=D.parent;return F.type==="parallel"&&Pe(F).every(function(q){return Ye(n.configuration,q)})&&R.push(Re(F.id)),R}));n.exitSet.sort(function(E,R){return R.order-E.order}),n.entrySet.sort(function(E,R){return E.order-R.order});var T=new Set(n.entrySet),p=new Set(n.exitSet),j=Array.from(T).map(function(E){var R=E.onEntry,D=E.activities.map(function(F){return Gr(F)});return te(s?P(P([],x(R),!1),x(D),!1):P(P([],x(D),!1),x(R),!1),f.machine.options.actions)}).concat([w.map(Jr)]),M=Array.from(p).map(function(E){return te(P(P([],x(E.onExit),!1),x(E.activities.map(function(R){return Yr(R)})),!1),f.machine.options.actions)}),C=M.concat([te(n.actions,this.machine.options.actions)]).concat(j);if(r){var B=te(U(P([],x(e),!1).sort(function(E,R){return R.order-E.order}).map(function(E){return E.onExit})),this.machine.options.actions).filter(function(E){return E.type!==he&&(E.type!==we||!!E.to&&E.to!==ee.Internal)});return C.concat([B])}return C},t.prototype.transition=function(e,r,n,i){e===void 0&&(e=this.initialState);var a=be(r),o;if(e instanceof ne)o=n===void 0?e:this.resolveState(ne.from(e,n));else{var s=O(e)?this.resolve(ke(this.getResolvedPath(e))):this.resolve(e),u=n!=null?n:this.machine.context;o=this.resolveState(ne.from(s,u))}if(!V&&a.name===De)throw new Error("An event cannot have the wildcard type ('".concat(De,"')"));if(this.strict&&!this.events.includes(a.name)&&!ji(a.name))throw new Error("Machine '".concat(this.id,"' does not accept event '").concat(a.name,"'"));var l=this._transition(o.value,o,a)||{transitions:[],configuration:[],entrySet:[],exitSet:[],source:o,actions:[]},c=Te([],this.getStateNodes(o.value)),d=l.configuration.length?Te(c,l.configuration):c;return l.configuration=P([],x(d),!1),this.resolveTransition(l,o,o.context,i,a)},t.prototype.resolveRaisedTransition=function(e,r,n,i){var a,o=e.actions;return e=this.transition(e,r,void 0,i),e._event=n,e.event=n.data,(a=e.actions).unshift.apply(a,P([],x(o),!1)),e},t.prototype.resolveTransition=function(e,r,n,i,a){var o,s,u,l,c=this;a===void 0&&(a=ze);var d=e.configuration,f=!r||e.transitions.length>0,v=f?e.configuration:r?r.configuration:[],g=Ye(v,this),m=f?ta(this.machine,d):void 0,S=r?r.historyValue?r.historyValue:e.source?this.machine.historyValue(r.value):void 0:void 0,A=this.getActions(new Set(v),g,e,n,a,r,i),y=r?h({},r.activities):{};try{for(var w=N(A),T=w.next();!T.done;T=w.next()){var p=T.value;try{for(var j=(u=void 0,N(p)),M=j.next();!M.done;M=j.next()){var C=M.value;C.type===bt?y[C.activity.id||C.activity.type]=C:C.type===Rt&&(y[C.activity.id||C.activity.type]=!1)}}catch(k){u={error:k}}finally{try{M&&!M.done&&(l=j.return)&&l.call(j)}finally{if(u)throw u.error}}}}catch(k){o={error:k}}finally{try{T&&!T.done&&(s=w.return)&&s.call(w)}finally{if(o)throw o.error}}var B=x(We(this,r,n,a,A,i,this.machine.config.predictableActionArguments||this.machine.config.preserveActionOrder),2),E=B[0],R=B[1],D=x(Ii(E,function(k){return k.type===he||k.type===we&&k.to===ee.Internal}),2),F=D[0],q=D[1],ie=E.filter(function(k){var Ee;return k.type===bt&&((Ee=k.activity)===null||Ee===void 0?void 0:Ee.type)===qe}),Ue=ie.reduce(function(k,Ee){return k[Ee.activity.id]=ea(Ee.activity,c.machine,R,a),k},r?h({},r.children):{}),Ze=new ne({value:m||r.value,context:R,_event:a,_sessionid:r?r._sessionid:null,historyValue:m?S?_i(S,m):void 0:r?r.historyValue:void 0,history:!m||e.source?r:void 0,actions:m?q:[],activities:m?y:r?r.activities:{},events:[],configuration:v,transitions:e.transitions,children:Ue,done:g,tags:un(v),machine:this}),pn=n!==R;Ze.changed=a.name===Tt||pn;var Se=Ze.history;Se&&delete Se.history;var yn=!g&&(this._transient||d.some(function(k){return k._transient}));if(!f&&(!yn||a.name===ye))return Ze;var Y=Ze;if(!g)for(yn&&(Y=this.resolveRaisedTransition(Y,{type:Pr},a,i));F.length;){var ha=F.shift();Y=this.resolveRaisedTransition(Y,ha._event,a,i)}var va=Y.changed||(Se?!!Y.actions.length||pn||typeof Se.value!=typeof Y.value||!fn(Y.value,Se.value):void 0);return Y.changed=va,Y.history=Se,Y},t.prototype.getStateNode=function(e){if(ge(e))return this.machine.getStateNodeById(e);if(!this.states)throw new Error("Unable to retrieve child state '".concat(e,"' from '").concat(this.id,"'; no child states exist."));var r=this.states[e];if(!r)throw new Error("Child state '".concat(e,"' does not exist on '").concat(this.id,"'"));return r},t.prototype.getStateNodeById=function(e){var r=ge(e)?e.slice(It.length):e;if(r===this.id)return this;var n=this.machine.idMap[r];if(!n)throw new Error("Child state node '#".concat(r,"' does not exist on machine '").concat(this.id,"'"));return n},t.prototype.getStateNodeByPath=function(e){if(typeof e=="string"&&ge(e))try{return this.getStateNodeById(e.slice(1))}catch{}for(var r=Ut(e,this.delimiter).slice(),n=this;r.length;){var i=r.shift();if(!i.length)break;n=n.getStateNode(i)}return n},t.prototype.resolve=function(e){var r,n=this;if(!e)return this.initialStateValue||me;switch(this.type){case"parallel":return Ae(this.initialStateValue,function(a,o){return a?n.getStateNode(o).resolve(e[o]||a):me});case"compound":if(O(e)){var i=this.getStateNode(e);return i.type==="parallel"||i.type==="compound"?(r={},r[e]=i.initialStateValue,r):e}return Object.keys(e).length?Ae(e,function(a,o){return a?n.getStateNode(o).resolve(a):me}):this.initialStateValue||{};default:return e||me}},t.prototype.getResolvedPath=function(e){if(ge(e)){var r=this.machine.idMap[e.slice(It.length)];if(!r)throw new Error("Unable to find state node '".concat(e,"'"));return r.path}return Ut(e,this.delimiter)},Object.defineProperty(t.prototype,"initialStateValue",{get:function(){var e;if(this.__cache.initialStateValue)return this.__cache.initialStateValue;var r;if(this.type==="parallel")r=Ir(this.states,function(n){return n.initialStateValue||me},function(n){return n.type!=="history"});else if(this.initial!==void 0){if(!this.states[this.initial])throw new Error("Initial state '".concat(this.initial,"' not found on '").concat(this.key,"'"));r=Ge(this.states[this.initial])?this.initial:(e={},e[this.initial]=this.states[this.initial].initialStateValue,e)}else r={};return this.__cache.initialStateValue=r,this.__cache.initialStateValue},enumerable:!1,configurable:!0}),t.prototype.getInitialState=function(e,r){this._init();var n=this.getStateNodes(e);return this.resolveTransition({configuration:n,entrySet:P([],x(n),!1),exitSet:[],transitions:[],source:void 0,actions:[]},void 0,r!=null?r:this.machine.context,void 0)},Object.defineProperty(t.prototype,"initialState",{get:function(){var e=this.initialStateValue;if(!e)throw new Error("Cannot retrieve initial state from simple state '".concat(this.id,"'."));return this.getInitialState(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"target",{get:function(){var e;if(this.type==="history"){var r=this.config;O(r.target)?e=ge(r.target)?ke(this.machine.getStateNodeById(r.target).path.slice(this.path.length-1)):r.target:e=r.target}return e},enumerable:!1,configurable:!0}),t.prototype.getRelativeStateNodes=function(e,r,n){return n===void 0&&(n=!0),n?e.type==="history"?e.resolveHistory(r):e.initialStateNodes:[e]},Object.defineProperty(t.prototype,"initialStateNodes",{get:function(){var e=this;if(Ge(this))return[this];if(this.type==="compound"&&!this.initial)return V||K(!1,"Compound state node '".concat(this.id,"' has no initial state.")),[this];var r=He(this.initialStateValue);return U(r.map(function(n){return e.getFromRelativePath(n)}))},enumerable:!1,configurable:!0}),t.prototype.getFromRelativePath=function(e){if(!e.length)return[this];var r=x(e),n=r[0],i=r.slice(1);if(!this.states)throw new Error("Cannot retrieve subPath '".concat(n,"' from node with no states"));var a=this.getStateNode(n);if(a.type==="history")return a.resolveHistory();if(!this.states[n])throw new Error("Child state '".concat(n,"' does not exist on '").concat(this.id,"'"));return this.states[n].getFromRelativePath(i)},t.prototype.historyValue=function(e){if(!!Object.keys(this.states).length)return{current:e||this.initialStateValue,states:Ir(this.states,function(r,n){if(!e)return r.historyValue();var i=O(e)?void 0:e[n];return r.historyValue(i||r.initialStateValue)},function(r){return!r.history})}},t.prototype.resolveHistory=function(e){var r=this;if(this.type!=="history")return[this];var n=this.parent;if(!e){var i=this.target;return i?U(He(i).map(function(o){return n.getFromRelativePath(o)})):n.initialStateNodes}var a=Li(n.path,"states")(e).current;return O(a)?[n.getStateNode(a)]:U(He(a).map(function(o){return r.history==="deep"?n.getFromRelativePath(o):[n.states[o[0]]]}))},Object.defineProperty(t.prototype,"stateIds",{get:function(){var e=this,r=U(Object.keys(this.states).map(function(n){return e.states[n].stateIds}));return[this.id].concat(r)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"events",{get:function(){var e,r,n,i;if(this.__cache.events)return this.__cache.events;var a=this.states,o=new Set(this.ownEvents);if(a)try{for(var s=N(Object.keys(a)),u=s.next();!u.done;u=s.next()){var l=u.value,c=a[l];if(c.states)try{for(var d=(n=void 0,N(c.events)),f=d.next();!f.done;f=d.next()){var v=f.value;o.add("".concat(v))}}catch(g){n={error:g}}finally{try{f&&!f.done&&(i=d.return)&&i.call(d)}finally{if(n)throw n.error}}}}catch(g){e={error:g}}finally{try{u&&!u.done&&(r=s.return)&&r.call(s)}finally{if(e)throw e.error}}return this.__cache.events=Array.from(o)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ownEvents",{get:function(){var e=new Set(this.transitions.filter(function(r){return!(!r.target&&!r.actions.length&&r.internal)}).map(function(r){return r.eventType}));return Array.from(e)},enumerable:!1,configurable:!0}),t.prototype.resolveTarget=function(e){var r=this;if(e!==void 0)return e.map(function(n){if(!O(n))return n;var i=n[0]===r.delimiter;if(i&&!r.parent)return r.getStateNodeByPath(n.slice(1));var a=i?r.key+n:n;if(r.parent)try{var o=r.parent.getStateNodeByPath(a);return o}catch(s){throw new Error("Invalid transition definition for state node '".concat(r.id,`':
`).concat(s.message))}else return r.getStateNodeByPath(a)})},t.prototype.formatTransition=function(e){var r=this,n=$i(e.target),i="internal"in e?e.internal:n?n.some(function(u){return O(u)&&u[0]===r.delimiter}):!0,a=this.machine.options.guards,o=this.resolveTarget(n),s=h(h({},e),{actions:te(G(e.actions)),cond:qr(e.cond,a),target:o,source:this,internal:i,eventType:e.event,toJSON:function(){return h(h({},s),{target:s.target?s.target.map(function(u){return"#".concat(u.id)}):void 0,source:"#".concat(r.id)})}});return s},t.prototype.formatTransitions=function(){var e,r,n=this,i;if(!this.config.on)i=[];else if(Array.isArray(this.config.on))i=this.config.on;else{var a=this.config.on,o=De,s=a[o],u=s===void 0?[]:s,l=Ot(a,[typeof o=="symbol"?o:o+""]);i=U(Object.keys(l).map(function(y){!V&&y===ye&&K(!1,"Empty string transition configs (e.g., `{ on: { '': ... }}`) for transient transitions are deprecated. Specify the transition in the `{ always: ... }` property instead. "+'Please check the `on` configuration for "#'.concat(n.id,'".'));var w=ve(y,l[y]);return V||ua(n,y,w),w}).concat(ve(De,u)))}var c=this.config.always?ve("",this.config.always):[],d=this.config.onDone?ve(String(Re(this.id)),this.config.onDone):[];V||K(!(this.config.onDone&&!this.parent),'Root nodes cannot have an ".onDone" transition. Please check the config of "'.concat(this.id,'".'));var f=U(this.invoke.map(function(y){var w=[];return y.onDone&&w.push.apply(w,P([],x(ve(String(en(y.id)),y.onDone)),!1)),y.onError&&w.push.apply(w,P([],x(ve(String(tn(y.id)),y.onError)),!1)),w})),v=this.after,g=U(P(P(P(P([],x(d),!1),x(f),!1),x(i),!1),x(c),!1).map(function(y){return G(y).map(function(w){return n.formatTransition(w)})}));try{for(var m=N(v),S=m.next();!S.done;S=m.next()){var A=S.value;g.push(A)}}catch(y){e={error:y}}finally{try{S&&!S.done&&(r=m.return)&&r.call(m)}finally{if(e)throw e.error}}return g},t}(),dn=!1;function hn(t,e){return!V&&!t.predictableActionArguments&&!dn&&(dn=!0,console.warn("It is highly recommended to set `predictableActionArguments` to `true` when using `createMachine`. https://xstate.js.org/docs/guides/actions.html")),new fa(t,e)}var W=Qr,_t=re;const Ft={progress:null,loaded:0,error:null},vn=()=>hn({predictableActionArguments:!0,schema:{context:{},events:{}},tsTypes:{},context:{...Ft},initial:"idle",on:{DESTROY:{actions:"sendDestroy",target:"stopped"}},states:{idle:{on:{ADD:{actions:"addFile"},UPLOAD:{cond:"hasFile",target:"uploading"}}},uploading:{entry:"resetProgress",on:{UPLOAD_PROGRESS:{actions:["incrementProgress","sendProgress"]},UPLOAD_DONE:"uploaded",UPLOAD_ERROR:"error",CANCEL:"idle"},invoke:{src:"uploadFile"}},uploaded:{entry:["setFileMetadata","sendDone"]},error:{entry:["setError","sendError"]},stopped:{type:"final"}}},{guards:{hasFile:(t,e)=>!!t.file||!!e.file},actions:{incrementProgress:W({loaded:(t,{loaded:e})=>e,progress:(t,{progress:e})=>e}),setFileMetadata:W({id:(t,{id:e})=>e,bucketId:(t,{bucketId:e})=>e,progress:t=>100}),setError:W({error:(t,{error:e})=>e}),sendProgress:()=>{},sendError:()=>{},sendDestroy:()=>{},sendDone:()=>{},resetProgress:W({progress:t=>null,loaded:t=>0}),addFile:W({file:(t,{file:e})=>e,bucketId:(t,{bucketId:e})=>e,id:(t,{id:e})=>e})},services:{uploadFile:(t,e)=>r=>{const n={"Content-Type":"multipart/form-data"},i=e.id||t.id;i&&(n["x-nhost-file-id"]=i);const a=e.bucketId||t.bucketId;a&&(n["x-nhost-bucket-id"]=a);const o=e.file||t.file;n["x-nhost-file-name"]=e.name||o.name;const s=new FormData;s.append("file",o),e.adminSecret&&(n["x-hasura-admin-secret"]=e.adminSecret),e.accessToken&&(n.Authorization=`Bearer ${e.accessToken}`);let u=0;const l=new AbortController;return Or.post(e.url+"/files",s,{headers:n,signal:l.signal,onUploadProgress:c=>{const d=Math.round(c.loaded*o.size/c.total),f=d-u;u=d,r({type:"UPLOAD_PROGRESS",progress:Math.round(d*100/c.total),loaded:d,additions:f})}}).then(({data:{id:c,bucketId:d}})=>{r({type:"UPLOAD_DONE",id:c,bucketId:d})}).catch(({response:c,message:d})=>{var f,v,g,m,S;r({type:"UPLOAD_ERROR",error:{status:(f=c==null?void 0:c.status)!=null?f:0,message:((g=(v=c==null?void 0:c.data)==null?void 0:v.error)==null?void 0:g.message)||d,error:((S=(m=c==null?void 0:c.data)==null?void 0:m.error)==null?void 0:S.message)||d}})}),()=>{l.abort()}}}}),{pure:$t,sendParent:Qe}=Ki,la=()=>hn({id:"files-list",schema:{context:{},events:{}},tsTypes:{},predictableActionArguments:!0,context:{progress:null,files:[],loaded:0,total:0},initial:"idle",on:{UPLOAD:{cond:"hasFileToDownload",actions:"addItem",target:"uploading"},ADD:{actions:"addItem"},REMOVE:{actions:"removeItem"}},states:{idle:{entry:["resetProgress","resetLoaded","resetTotal"],on:{CLEAR:{actions:"clearList",target:"idle"}}},uploading:{entry:["upload","startProgress","resetLoaded","resetTotal"],on:{UPLOAD_PROGRESS:{actions:["incrementProgress"]},UPLOAD_DONE:[{cond:"isAllUploaded",target:"uploaded"},{cond:"isAllUploadedOrError",target:"error"}],UPLOAD_ERROR:[{cond:"isAllUploaded",target:"uploaded"},{cond:"isAllUploadedOrError",target:"error"}],CANCEL:{actions:"cancel",target:"idle"}}},uploaded:{entry:"setUploaded",on:{CLEAR:{actions:"clearList",target:"idle"}}},error:{on:{CLEAR:{actions:"clearList",target:"idle"}}}}},{guards:{hasFileToDownload:(t,e)=>t.files.some(r=>r.getSnapshot().matches("idle"))||!!e.files,isAllUploaded:t=>t.files.every(e=>{var r;return(r=e.getSnapshot())==null?void 0:r.matches("uploaded")}),isAllUploadedOrError:t=>t.files.every(e=>{const r=e.getSnapshot();return(r==null?void 0:r.matches("error"))||(r==null?void 0:r.matches("uploaded"))})},actions:{incrementProgress:W((t,e)=>{const r=t.loaded+e.additions,n=Math.round(r*100/t.total);return{...t,loaded:r,progress:n}}),setUploaded:W({progress:t=>100,loaded:({files:t})=>t.map(e=>e.getSnapshot()).filter(e=>e.matches("uploaded")).reduce((e,r)=>{var n;return e+((n=r.context.file)==null?void 0:n.size)},0)}),resetTotal:W({total:({files:t})=>t.map(e=>e.getSnapshot()).filter(e=>!e.matches("uploaded")).reduce((e,r)=>{var n;return e+((n=r.context.file)==null?void 0:n.size)},0)}),resetLoaded:W({loaded:t=>0}),startProgress:W({progress:t=>0}),resetProgress:W({progress:t=>null}),addItem:W((t,{files:e,bucketId:r})=>{const n=e?Array.isArray(e)?e:"length"in e?Array.from(e):[e]:[],i=t.total+n.reduce((o,s)=>o+s.size,0),a=Math.round(t.loaded*100/i);return{files:[...t.files,...n.map(o=>aa(vn().withConfig({actions:{sendProgress:Qe((s,{additions:u})=>({type:"UPLOAD_PROGRESS",additions:u})),sendDone:Qe("UPLOAD_DONE"),sendError:Qe("UPLOAD_ERROR"),sendDestroy:Qe("REMOVE")}}).withContext({...Ft,file:o,bucketId:r}),{sync:!0}))],total:i,loaded:t.loaded,progress:a}}),removeItem:W({files:t=>t.files.filter(e=>{var n,i;const r=(n=e.getSnapshot())==null?void 0:n.matches("stopped");return r&&((i=e.stop)==null||i.call(e)),!r})}),clearList:$t(t=>t.files.map(e=>_t({type:"DESTROY"},{to:e.id}))),upload:$t((t,e)=>t.files.map(r=>_t(e,{to:r.id}))),cancel:$t(t=>t.files.map(e=>_t({type:"CANCEL"},{to:e.id})))}}),ca=async(t,e,r)=>new Promise(n=>{e.send({type:"UPLOAD",url:t.storage.url,accessToken:t.auth.getAccessToken(),adminSecret:t.adminSecret,...r}),e.subscribe(i=>{var a;i.matches("error")?n({error:i.context.error,isError:!0,isUploaded:!1}):i.matches("uploaded")&&n({error:null,isError:!1,isUploaded:!0,id:i.context.id,bucketId:i.context.id,name:(a=i.context.file)==null?void 0:a.name})})}),da=async(t,e,r)=>new Promise(n=>{e.send({type:"UPLOAD",url:t.storage.url,accessToken:t.auth.getAccessToken(),adminSecret:t.adminSecret,bucketId:r==null?void 0:r.bucketId,files:r==null?void 0:r.files}),e.onTransition(i=>{i.matches("error")?n({errors:i.context.files.filter(a=>{var o;return(o=a.getSnapshot())==null?void 0:o.context.error}),isError:!0,files:[]}):i.matches("uploaded")&&n({errors:[],isError:!1,files:i.context.files})})});I.HasuraStorageApi=br,I.HasuraStorageClient=Oi,I.INITIAL_FILE_CONTEXT=Ft,I.createFileUploadMachine=vn,I.createMultipleFilesUploadMachine=la,I.uploadFilePromise=ca,I.uploadMultipleFilesPromise=da,Object.defineProperties(I,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
//# sourceMappingURL=hasura-storage-js.umd.js.map
